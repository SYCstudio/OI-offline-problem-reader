<html><head><meta name=keywords content="HDOJ ACM ICPC OJ C C++ Pascal Java"><meta http-equiv=Content-Type content="text/html;charset=gb2312"><link rel=stylesheet type=text/css href="/images/global.css" media=all><link rel=stylesheet type=text/css href="/css/diyinhead.css" media=all><link rel=stylesheet type=text/css href="/css/webinhead.css" media=all><script src="/js/global.js" type=text/javascript></script><script src="/js/register.js" type=text/javascript></script><script src="/js/MathJax/MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><title>Problem - 4934</title></head><body >
<a name=top></a>
<table align=center cellSpacing=0 cellPadding=0 width=980 border=0 style="word-wrap:break-word">
<tr>
	<td style="border:#1A5CC8 1px solid" align=center width=100%>
		<a href="/">
			<img src="/images/banner.jpg" width="100%" height=116 border=0>
		</a>
	</td>
</tr>
<tr>
	<td style="border:#1A5CC8 1px solid">
	<table cellSpacing=0 cellPadding=1 width="979px">
	<tr bgcolor=#1A5CC8 align=center class=banner height=25>
		<td>Online Judge</td>
		<td>Online Exercise</td>
		<td>Online Teaching</td>
		<td>Online Contests</td>
	<td>Exercise Author</td>
	</tr>
	<tr style="font-size:16px" align=center>
		<td width=20% valign=top>
		<a href="/faq.php" style="text-decoration: none">F.A.Q</a><br>
		<a href="/friends" style="text-decoration: none">Hand In Hand</a><br>
		<a href="/onlineuser.php" style="text-decoration: none">Online Acmers</a>	<br>
		<!-- /onlineuser.php-->
		
		<a href="/forum" style="text-decoration: none">Forum | </a><a href="/discuss/public/list.php" style="text-decoration: none">Discuss</a><br>
		<a href="/statistic/submit_graph.php" style="text-decoration: none">Statistical Charts</a><br>
		</td>
		<td width=20% valign=top>
		<form action="/search.php" method=get>
		<a href="/listproblem.php?vol=1" style="text-decoration: none">Problem Archive</a><br/>
		<!--<a href="http://feeds.feedburner.com/Hdoj-problemset"><img src="/images/rss1.jpg" alt="problemset" style="vertical-align:text-bottom;"width=20 height=20></a><br>-->
		<!--
			 <a href="/submit.php">Submit Solution</a><br>
		-->	
		<a href="/status.php" style="text-decoration: none">Realtime Judge Status</a><br>

		<a href="/ranklist.php" style="text-decoration: none">Authors Ranklist</a><br>
		<input name=field value=author type=hidden><input class=text60 name=key>&nbsp;<input class=button40 type=submit value=Search>
		
		<!--
			<input name=field value=problem type=hidden><input class=text60 name=key>&nbsp;<input class=button40 type=submit value=Search>
		-->
		</form>
		</td>
		<td width=20% valign=top>
		 <form action='/search.php' method=get> 
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none" href="http://code.hdu.edu.cn/">C/C++/Java Exams &nbsp;&nbsp;&nbsp;&nbsp;</a><br/>
		<a style="text-decoration: none" href="/game">ACM Steps</a><br/>
		<a href = "/ITJobs/">Go to Job</a><br/>	
		<a href="/livecast" style="text-decoration: none">Contest LiveCast</a><br/>
		<a style="text-decoration: none" href="/region">ICPC@China</a><br/>
		<!-- <a href="/register.php">Register New Author</a><br> -->
		<!-- <a href="/modifyuser.php">Update Your Information</a><br> -->
		</form>
		</td>
		<td width=20% valign=top>
		<a href="http://bestcoder.hdu.edu.cn" style="text-decoration: none; color: red; font-weight: bold;">Best Coder <sup style="color: gray;">beta</sup></a><br/><a href="/vip/contest_list.php" style="text-decoration: none">VIP</a> | <a href="/contests/contest_list.php" style="text-decoration: none">STD Contests</a><br /><a href="http://code.hdu.edu.cn/vcontest" style="text-decoration: none">Virtual Contests </a><br/>&nbsp;&nbsp;<a href="/diy/contest_list.php" style="text-decoration: none">&nbsp;&nbsp;DIY | </a><a href="/webcontest" style="text-decoration: none"><font color="">Web-DIY</font> <font size=1 color="gray"><sup>beta</sup></font></a><br/><a style="text-decoration: none" href="/recentcontest">Recent Contests</a><br/>		</td>
		<td width=20%>
					<form method=post action="/userloginex.php?action=login">
			  <table width=168 border=0 align=center cellspacing=0>
			  	<tr><td align=center colspan=2><a href="/qqlogin/oauth/login.php"><img src="/qqlogin/images/qqlogin.png" border="0" /></a></td></tr>
				<tr><td width=68>Author ID&nbsp;</td><td align=right><input name=username type=text class=text90 maxlength=20></td></tr>
				<tr><td>Password&nbsp;</td><td align=right><input name=userpass type=password class=text90 maxlength=20></td></tr>
			  </table>
			  <input name=login type=submit class=button40 value="Sign In">&nbsp;<a href="http://bestcoder.hdu.edu.cn/register.php?url=acm.hdu.edu.cn/userloginex.php?action=login" style="text-decoration: none">Register new ID</a>
			</form>
						</td>
	</tr>
	</table>
	</td>
</tr>
<tr>
	<td>
		<div align=center id=rollword><marquee scrollamount=2 width=600 scrolldelay=30 onMouseOver="javascript:this.stop();" onMouseOut="javascript:this.start();"><b style="margin-right:20px"></b></marquee></div>	</td>
</tr>
<tr><td align=center><h1 style='color:#1A5CC8'>Protocol Buffers</h1><font><b><span style='font-family:Arial;font-size:12px;font-weight:bold;color:green'>Time Limit: 2000/1000 MS (Java/Others)&nbsp;&nbsp;&nbsp;&nbsp;Memory Limit: 65536/65536 K (Java/Others)<br>Total Submission(s): 148&nbsp;&nbsp;&nbsp;&nbsp;Accepted Submission(s): 10<br></span></b></font><br><br><div class=panel_title align=left>Problem Description</div> <div class=panel_content>Protocol Buffers are a way of encoding structured data in an efficient yet extensible format. Google uses Protocol Buffers for almost all of its internal RPC protocols and file formats. In this problem, you will use a simplified version of protocol buffers.<br><br><b>Message definition:</b><br>In protocol buffers, we defining a message in a very simple way:<br>    message Gao {<br>      required int32 a = 1;<br>      required int32 b = 2;<br>      required string str = 3;<br>      repeated int32 arr = 4;<br>      optional int32 optionalField = 5;<br>    }<br>The Gao message definition specifies five fields (name/value pairs), one for each piece of data that you want to include in this type of message. In this problem, there are at most 15 fields in one message definition.<br><br><b>Field definition:</b><br>Foremost, we need specifying field rules in one of the following:<br>  1. required: message must have exactly one of this field.<br>  2. optional: message can have zero or one of this field (but not more than one).<br>  3. repeated: this field can be repeated any number of times (including zero) in message. The order of the repeated values will be preserved.<br>Follow by the field rules, we definiting field by type and name. we support int32 and string type in this problem. Each field has assigned a unique numbered tag at the end. These tags are used to identify your fields in the message binary format. The smallest tag number is 1, and the largest is 15. Field name is consist of letters([a-zA-Z]) and do not exceed 15 characters.<br><br><b>Base 128 Varints:</b><br>To understand your simple protocol buffer encoding, you first need to understand varints. Varints are a method of serializing integers using one or more bytes. Smaller numbers take a smaller number of bytes. Each byte in a varint, except the last byte, has the most significant bit (msb) set –– this indicates that there are further bytes to come. The lower 7 bits of each byte are used to store the two's complement representation of the number in groups of 7 bits, least significant group first.<br>So, for example, here is the number 1 –– it's a single byte, so the msb is not set:<br>    0000 0001<br>And here is 300 – this is a bit more complicated:<br>    1010 1100 0000 0010<br>How do you figure out that this is 300? First you drop the msb from each byte, as this is just there to tell us whether we've reached the end of the number (as you can see, it's set in the first byte as there is more than one byte in the varint):<br>    1010 1100 0000 0010<br>    → 010 1100  000 0010<br>You reverse the two groups of 7 bits because, as you remember, varints store numbers with the least significant group first. Then you concatenate them to get your final value:<br>    000 0010  010 1100<br>    →  000 0010 ++ 010 1100<br>    →  100101100<br>    →  256 + 32 + 8 + 4 = 300<br>(++ means byte concatenation)<br>It's more complex to consider signed number, due to simplify this problem, we only need considered unsigned integers in range [0, 10^9].<br><br><b>Message structure:</b><br>As you know, a protocol buffer message is a series of key-value pairs. The binary version of a message just uses the field's tag number as the key –– the name and declared type for each field can only be determined on the decoding end by referencing the message type's definition. The &quot;key&quot; for each pair in a wire-format message is actually two values – the field tag number from your message definition, plus a wire type that provides just enough information to find the length of the following value.<br>The available wire types are as follows:<br>    Type    Meaning                 Used for<br>    0       Varint                  int32<br>    2       Length-delimited        string,repeated fields<br>Each key in the streamed message is a varint with the value (field_tag_number &lt;&lt; 3) | wire_type –– in other words, the last three bits of the number store the wire type. For example, key of field a in message Gao is encoded as 0000 1000(08), and for field str is 0001 1010(1A). Field a seted as 150 will be encoded as 08 96 01 (Key is 08 and 150 encoded as 96 01). Concatenate all encoded fields we can get the encoded message.<br><br><b>Optional Elements:</b><br>If any of fields are optional, the encoded message may not have a key-value pair with that field, in this situation, just set the value of this field as null.<br><br><b>String and Repeated Elements:</b><br>In this situation, we need specifiy payload size (varint type) first after key, and followed by the elements. (We can regard string type as a array)<br>For example:<br>    message Test3 {<br>      required string b = 2;<br>      repeated int32 c = 3;<br>    }<br>Assume one message have the value &quot;testing&quot; for the field b and the values 3, 270, and 86942 for the repeated field c, then, the encoded form would be:<br>    12                    // tag (field number 2, wire type 2)<br>    07                    // payload size (7 bytes)<br>    74 65 73 74 69 6E 67  // ascii code of &quot;testing&quot;<br>    1A                    // tag (field number 3, wire type 2)<br>    06                    // payload size (6 bytes)<br>    03                    // first element (varint 3)<br>    8E 02                 // second element (varint 270)<br>    9E A7 05              // third element (varint 86942)<br>Notice, repeated string type in this problem is illegal.<br>If any of repetead fields not appeared in this message, this field can regard as empty array([]).<br>The length of arrays and strings will not exceed 50 and strings only consist of alphabet('a' - 'z' and 'A' - 'Z').<br><br><b>Problem:</b><br>Now give you a message definition, and serval encoded messages, you task is decode this messages. </div><div class=panel_bottom>&nbsp;</div><br><div class=panel_title align=left>Input</div> <div class=panel_content>The first line of input contains a number T, indicating the number of test cases. (T≤10).<br><br>For each case, there will be two integers n (n≤17) and m (m≤100).<br><br>The next n lines consist of message definition, you can assume that the length of message definition will not exceed 1500. A valid definition will only contains alphabet('a' - 'z' and 'A' - 'Z'), number('0' - '9'), whitespace(' ') and control tokens('=;{}').<br><br>And then followed by m querys, each line contain one encoded byte stream in hexadecimal notation, there is one whitespace after each byte. And for there are at most 1500 bytes each message. Notice there will be some empty byte stream in test data, see sample input for more details.<br><br>All the messages in this problem will not contains unknown tags and have a illegal structure.</div><div class=panel_bottom>&nbsp;</div><br><div class=panel_title align=left>Output</div> <div class=panel_content>For each case, output Case #i: first. (i is the number of the test case, from 1 to T).<br><br>Then for each query, output the values in each fields, with the same order in message definition.<br><br>If any of required fields not appeared in this message, please print Error! instead.<br><br>Output a blank line after each query.</div><div class=panel_bottom>&nbsp;</div><br><div class=panel_title align=left>Sample Input</div><div class=panel_content><pre><div style="font-family:Courier New,Courier,monospace;">1
2 5
message Test1{required int32 a=1;required string b=2
;repeated int32 c=3;optional int32 optionalField=5;}
08 96 01 12 07 74 65 73 74 69 6e 67 1A 06 03 8E 02 9E A7 05 28 00
08 96 01 12 07 74 65 73 74 69 6e 67 1A 06 03 8E 02 9E A7 05

08 96 01 12 01 74
12 07 74 65 73 74 69 6e 67 1A 06 03 8E 02 9E A7 05</div></pre></div><div class=panel_bottom>&nbsp;</div><br><div class=panel_title align=left>Sample Output</div><div class=panel_content><pre><div style="font-family:Courier New,Courier,monospace;">Case #1:
a = 150
b = "testing"
c = [3, 270, 86942]
optionalField = 0

a = 150
b = "testing"
c = [3, 270, 86942]
optionalField = null

Error!

a = 150
b = "t"
c = []
optionalField = null

Error!</div></pre></div><div class=panel_bottom>&nbsp;</div><br><div class=panel_title align=left>Source</div> <div class=panel_content> <a href="/search.php?field=problem&key=BestCoder+Round+%234&source=1&searchmode=source"> BestCoder Round #4 </a> </div> <div class=panel_bottom>&nbsp;</div><br><div class=panel_title align=left>Recommend</div> <div class=panel_content>hujie</div><div class=panel_bottom>&nbsp;</div><br><center style='font-size:15px;font-family:Arial;font-weight:bold;color:#1A5CC8'><a href='statistic.php?pid=4934'>Statistic</a>&nbsp;|&nbsp;<a href='submit.php?pid=4934'>Submit</a>&nbsp;|&nbsp;<a href="./discuss/problem/list.php?problemid=4934">Discuss</a> | <a href='note/note.php?pid=4934'>Note</a><br></td></tr><tr>
<td>
	<table style="border:#1A5CC8 1px solid; font-size:14px" cellSpacing=0 cellPadding=1 width=100%>
	<tr align=center>
		<td class=footer_link height=45><a href="/">Home</a> | <a href=#top>Top</a></td>
		<td style="padding:6px">
			Hangzhou Dianzi University Online Judge 3.0<br>
			Copyright &copy; 2005-2018 <a href=mailto:acm@hdu.edu.cn>HDU ACM Team</a>. All Rights Reserved.<br>
			<a href="../about_us/developer.php">Designer & Developer </a>: <a>Wang Rongtao</a>&nbsp<a>LinLe</a>&nbsp<a href=mailto:gjavac@gmail.com >GaoJie</a>&nbsp<a href=mailto:gl8997@gmail.com >GanLu</a><br>
			<span class=pagerunstatus>Total 0.000000(s) query 2, Server time : 2018-07-08 00:13:11, Gzip disabled</span>		</td>
		<td class=footer_link>
			<!-- <a href="javascript:history.go(-1);">Back</a> | <a href="javascript:history.forward();">Forward</a>-->
			<a href="/admin">Administration</a>	
		</td>
	</tr>
	</table>
</td>
</tr>
</table>
</body></html>
