<html><head><link rel="stylesheet" type="text/css" href="../Semantic/semantic.min.css"><script src="../Semantic/jquery.min.js" type="text/javascript"></script><script src="../Semantic/semantic.min.js" type="text/javascript"></script><title>Another Letter Tree</title></head><body><div class="ui main container"><div class="ui center aligned grid"><div class="row"><h1 class="ui header">HDU4929. Another Letter Tree</h1></div><div class="row" style="margin-top: -15px"><span class="ui label">内存限制：12000/6000 MS (Java/Others)</span> <span class="ui label">时间限制：262144/262144 K (Java/Others)</span></div></div></br><div class="row"><div class="column"><h4 class="ui top attached block header">题目描述</h4><div class="ui bottom attached segment font-content"><div style="position: relative; overflow: hidden;">   A letter tree is given on this page (HDOJ 4601).<br><br>   Another letter tree of N nodes is now given, where each node is assigned to a lowercase letter. When making a tour from a node to another, one should always follow the shortest path between them. That is, no nodes should be visited twice during his tour.<br><br>   After one travels along a path, he will obtain a Path String formed by the letters assigned to nodes that he just moves past. The string exactly records all nodes in the order he visits.<br><br>   Now we’re faced with the problem. Initially we have a string S<sub>0</sub> and totally Q queries each in a shape of (u, v). For each query, we make a tour <b>from u to v</b> and obtain a Path String S<sub>uv</sub> , and your task is to calculate how many times that S<sub>0</sub> occurs as a subsequence of S<sub>uv</sub> . For example, “ab” occurs 3 times in “abab” as a subsequence.<br><br>   A subsequence is a sequence that can be derived from another sequence by deleting some elements without changing the order of the remaining elements. For instance, “abc” and “ec” are both subsequence of “adebc”, while “ba” and “ed” are not.<br><br>   The answer might be large, and thus you’re only required to output it modulo 10007.</div></div></div></div><div class="row"><div class="column"><h4 class="ui top attached block header">输入格式</h4><div class="ui bottom attached segment font-content"><div style="position: relative; overflow: hidden;">   The input consists of several test cases. The number of test cases T (T&lt;=5) occurs in the first line of input.<br><br>For each test case:<br>   The first line consists of two integers N and Q(1&lt;=N, Q&lt;=50000), denoting the number of nodes and queries, respectively.<br>   Each of the following N - 1 lines contains a pair of integers u, v(1&lt;=u, v&lt;=N ), denoting an edge between node u and v.<br>   The following line contains a string of N lowercase letters, where the ith denotes the letter represented by the ith node.<br>   The following line contains S<sub>0</sub>(1&lt;=|S<sub>0</sub>|&lt;=30).<br>   The following Q lines describe all queries, each of which describes the start node u and destination node v.<br></div></div></div></div><div class="row"><div class="column"><h4 class="ui top attached block header">输出格式</h4><div class="ui bottom attached segment font-content"><div style="position: relative; overflow: hidden;">   For each query, output the required answer modulo 10007 in a line.</div></div></div></div><div class="row"><div class="column"><h4 class="ui top attached block header">样例</h4><div class="ui bottom attached segment font-content"><div style="position: relative; overflow: hidden;"><h4>样例输入</h4><div class="ui existing segment"><pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain">2
6 3
1 2
1 3
2 4
2 5
3 6
abbaaa ab
4 5
4 6
2 1
6 3
1 2
1 3
2 4
2 5
3 6
abbaaa aba
4 5
4 6
2 1</code></pre></div><h4>样例输出</h4><div class="ui existing segment"><pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain">1
3
0
1
4
0</div></code></pre></div></div></div></div><div class="row"><div class="column"><h4 class="ui top attached block header">数据范围与提示</h4><div class="ui bottom attached segment font-content"><div style="position: relative; overflow: hidden;"> <a href="/search.php?field=problem&key=2014+Multi-University+Training+Contest+6&source=1&searchmode=source"> 2014 Multi-University Training Contest 6 </a> </div></div></div></div></div></div><div class="ui vertical footer segment"><div class="ui center aligned container"><span style="color: #999;">OI-offline-problem-reader Powered by <a href="http://www.sycstudio.com">SYCstudio</a>.</span></div></div></div></body></html>