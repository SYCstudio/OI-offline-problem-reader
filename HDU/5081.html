<html><head><link rel="stylesheet" type="text/css" href="../Semantic/semantic.min.css"><script src="../Semantic/jquery.min.js" type="text/javascript"></script><script src="../Semantic/semantic.min.js" type="text/javascript"></script><title>Trie</title></head><body><div class="ui main container"><div class="ui center aligned grid"><div class="row"><h1 class="ui header">HDU5081. Trie</h1></div><div class="row" style="margin-top: -15px"><span class="ui label">内存限制：12000/6000 MS (Java/Others)</span> <span class="ui label">时间限制：262144/262144 K (Java/Others)</span></div></div></br><div class="row"><div class="column"><h4 class="ui top attached block header">题目描述</h4><div class="ui bottom attached segment font-content"><div style="position: relative; overflow: hidden;">Little Bob studied Trie in Data Structure class. He learned that Trie is a rooted tree to store some strings. There is a character on each edge of a Trie. (In this problem, the valid characters are lowercase Latin letters.)<br><br>Bob draws a Trie with n nodes, and the nodes are numbered with integers from 1 to n. The number of the root node is always 1.<br><br>He uses S<sub>i</sub> to denote the string concatenated with characters on the path from the root to node i. It can be seen that S1 is the empty string. Furthermore, for a set P <img style='max-width:100%;' src=./data/images/C549-1012-2.jpg> {1, 2, . . . , n}, S<sub>P</sub> = {S<sub>i</sub> | i <img style='max-width:100%;' src=./data/images/C549-1012-3.jpg> P}.<br><br>Bob defines a kind of trait on this Trie. The trait can be described with a set P  <img style='max-width:100%;' src=./data/images/C549-1012-2.jpg> {1, 2, . . . , n}. We say a string a has this trait, if and only if there exists a string b <img style='max-width:100%;' src=./data/images/C549-1012-3.jpg> S<sub>P</sub> such that a ends with b. Here string a ends with string b means the last |b| characters of a is exactly b. (Note that every string ends with the empty string).<br><br>Bob also defines a mapping f on P <img style='max-width:100%;' src=./data/images/C549-1012-2.jpg>{1, 2, ..., n}, and f (P) is also a subset of {1, 2, . . . , n}. i <img style='max-width:100%;' src=./data/images/C549-1012-3.jpg> f (P) if and only if there exists j <img style='max-width:100%;' src=./data/images/C549-1012-3.jpg> P such that S<sub>j</sub> ends with S<sub>i</sub>.<br><br>Initially, there is no traits been defined. Bob will add traits whenever he wants. Let D<sub>i</sub> denote the number of traits that S<sub>i</sub> has until now. Note that D<sub>i</sub> may change when a new trait is added.<br><br>Besides adding new traits, Bob may also ask you something about his Trie. In each query, Bob will give you a set P <img style='max-width:100%;' src=./data/images/C549-1012-2.jpg> {1, 2, . . . , n}, and you need to compute <img style='max-width:100%;' src=./data/images/C549-1012-4.jpg>. Are you willing to do this for Bob?</div></div></div></div><div class="row"><div class="column"><h4 class="ui top attached block header">输入格式</h4><div class="ui bottom attached segment font-content"><div style="position: relative; overflow: hidden;">The first line contains an integer T (T ≤ 5), denoting the number of the test cases.<br><br>For each test case, the first line contains an integer n(1 ≤ n ≤ 10<sup>5</sup>).<br><br>From the second to the n-th line, this n - 1 lines describe Bob' s Trie.  The i-th line contains an integer u(u &lt; i), and a lowercase letter c, which means that the father of node i is node u and the character on that edge is c. We ensure that for each node i, letters on edges connecting i and its children are all different.<br><br>The next line contains an integer m(m ≤ 10<sup>5</sup>), which means there are m operations.<br><br>The next m lines describe all operations. In each line, the first integer indicates the type of this operation. 1 means Bob will add a new trait and 2 means Bob is asking you a question. The second integer k is the size of set P , and the next k integers are the elements of P. We ensure that these k integers are different, and they are all between 1 and n. The total size of the m sets will not be larger than 5·10<sup>5</sup>.</div></div></div></div><div class="row"><div class="column"><h4 class="ui top attached block header">输出格式</h4><div class="ui bottom attached segment font-content"><div style="position: relative; overflow: hidden;">For each test case, output the answer for each query operation, one answer in a line.</div></div></div></div><div class="row"><div class="column"><h4 class="ui top attached block header">样例</h4><div class="ui bottom attached segment font-content"><div style="position: relative; overflow: hidden;"><h4>样例输入</h4><div class="ui existing segment"><pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain">1
6
1 a
1 b
1 c
3 a
3 b
5
1 2 3 4
2 2 5 6
1 2 2 3
2 2 4 5
2 1 6</code></pre></div><h4>样例输出</h4><div class="ui existing segment"><pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain">2
3
4</div></code></pre></div></div></div></div><div class="row"><div class="column"><h4 class="ui top attached block header">数据范围与提示</h4><div class="ui bottom attached segment font-content"><div style="position: relative; overflow: hidden;"> <a href="/search.php?field=problem&key=2014+Asia+AnShan+Regional+Contest&source=1&searchmode=source"> 2014 Asia AnShan Regional Contest </a> </div></div></div></div></div></div><div class="ui vertical footer segment"><div class="ui center aligned container"><span style="color: #999;">OI-offline-problem-reader Powered by <a href="http://www.sycstudio.com">SYCstudio</a>.</span></div></div></div></body></html>